<!DOCTYPE html>
<html lang="it">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8">
    <title>Oriani League</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="content"></div>

<script src="scriptDatabase.js"></script>
<script>
    async function loadPage() {
        const params = new URLSearchParams(window.location.search);
        const page = params.get("p") || "home";

        const content = document.querySelector(".content");
        content.innerHTML = "";
        if (page === "home")
            renderHome();
        else if (page === "squadre")
            await renderSquadre();
        else if (page === "gironi")
            await renderGironi();
        else if (page === "squadra")
            await renderSquadra();
        else if (page === "girone")
            await renderGirone();
        else if (page === "finali")
            await renderFinali();
    }

    async function loadAllData() {
        const [
            games,
            squadre,
            gironi,
            calciatori,
            marcatori
        ] = await Promise.all([
            loadGames(),
            loadSquadre(),
            loadGironi(),
            loadCalciatori(),
            loadMarcatori()
        ]);

        const gamesTable = document.getElementById("gamesTable");
        if (gamesTable) {
            renderGames(games, squadre);
        }

        const scorersTable = document.getElementById("scorersTable");
        if (scorersTable) {
            renderScorers(marcatori, calciatori, squadre, gironi);
        }
    }

    function formatDate(dateStr) {
        const date = new Date(dateStr);
        const day = String(date.getDate()).padStart(2, '0');
        const month = String(date.getMonth() + 1).padStart(2, '0'); // i mesi partono da 0
        const year = date.getFullYear();
        const hours = String(date.getHours()).padStart(2, '0');
        const minutes = String(date.getMinutes()).padStart(2, '0');

        return `${day}/${month}/${year} ${hours}:${minutes}`;
    }

    function renderHome() {
        document.querySelector(".content").innerHTML = `
        <h1>Oriani League</h1>

        <div class="navbar">
            <a href="?p=home" class="active">Home</a>
            <a href="?p=squadre">Squadre</a>
            <a href="?p=gironi">Gironi</a>
            <a href="?p=finali">Tabellone</a>
            <button id="themeToggle" onclick="toggleTheme()" class="navBarToggle">${document.body.classList.contains("dark") ? "‚òÄÔ∏è" : "üåô"}</button>
        </div>

        <div class="columns">
            <div style="flex: 1; text-align: center;">
                <h2>Partite</h2>
                <button id="hideShow" onclick="HideShow()">Mostra tutte le partite</button>
                <table id="gamesTable" class="games-table">
                    <tr>
                        <th>Squadra 1</th>
                        <th>Gol</th>
                        <th></th>
                        <th>Gol</th>
                        <th>Squadra 2</th>
                        <th>Data</th>
                    </tr>
                </table>
            </div>

            <div style="flex: 1; text-align: center;">
                <h2>Marcatori</h2>
                <button id="top20Btn" onclick="showTop20()">Mostra Top 20</button>
                <table id="scorersTable" class="games-table">
                    <tr>
                        <th>Giocatore</th>
                        <th>Squadra</th>
                        <th>Girone</th>
                        <th>Gol</th>
                    </tr>
                </table>
            </div>
        </div>
    `;
        loadAllData()
    }

    async function renderSquadre() {
        const squads = await loadSquadre();

        document.querySelector(".content").innerHTML = `
        <h1>Oriani League</h1>

        <div class="navbar">
            <a href="?p=home">Home</a>
            <a href="?p=squadre" class="active">Squadre</a>
            <a href="?p=gironi">Gironi</a>
            <a href="?p=finali">Tabellone</a>
            <button id="themeToggle" onclick="toggleTheme()" class="navBarToggle">${document.body.classList.contains("dark") ? "‚òÄÔ∏è" : "üåô"}</button>
        </div>

        <h2 style="text-align:center;">Squadre</h2>

        <div class="teams-container" id="teamsContainer"></div>
    `;

        const container = document.getElementById("teamsContainer");

        squads.forEach(t => {
            console.log(t['nome'].toLowerCase().replaceAll(' ', '').replaceAll('#', ''))
            const el = document.createElement("a");
            el.href = `?p=squadra&id=${t.id}`;
            el.className = "team-card";
            el.innerHTML = `
            <div class="team-logo">
                <img src="./images/${t['nome'].toLowerCase().replaceAll(' ', '').replaceAll('#', '')}.jpg" alt="${t.nome} Logo" onerror="this.onerror=null; this.src='./images/logo-placeholder.png';">
            </div>
            <div class="team-name">${t.nome}</div>
        `;
            container.appendChild(el);
        });
    }

    async function renderSquadra() {
        const params = new URLSearchParams(window.location.search);
        const id = Number(params.get("id"));

        const [
            squadre,
            gironi,
            games
        ] = await Promise.all([
            loadSquadre(),
            loadGironi(),
            loadGames()
        ]);

        const squadra = squadre.find(s => s.id === id);

        if (!squadra) {
            document.querySelector(".content").innerHTML = `
            <h2 style="text-align:center; color:#af0707;">Squadra non trovata!</h2>
        `;
            return;
        }

        const girone = gironi.find(g => g.id === squadra.girone);

        const squadreGirone = squadre
            .filter(s => s.girone === squadra.girone)
            .sort((a, b) => {
                if (a.punti !== b.punti) return b.punti - a.punti;
                return b.differenza_reti - a.differenza_reti;
            });

        const partite = games
            .filter(g => {
                const t1 = squadre.find(s => s.id === g.id1)?.nome;
                const t2 = squadre.find(s => s.id === g.id2)?.nome;
                return t1 === squadra.nome || t2 === squadra.nome;
            })
            .map(g => {
                return {
                    ...g,
                    team1: squadre.find(s => s.id === g.id1)?.nome ?? "???",
                    team2: squadre.find(s => s.id === g.id2)?.nome ?? "???"
                };
            }).sort((a, b) => new Date(a.orario) - new Date(b.orario));

        const content = document.querySelector(".content");
        content.innerHTML = `
        <h1>Oriani League</h1>

        <div class="navbar">
            <a href="?p=home">Home</a>
            <a href="?p=squadre" class="active">Squadre</a>
            <a href="?p=gironi">Gironi</a>
            <a href="?p=finali">Tabellone</a>
            <button id="themeToggle" onclick="toggleTheme()" class="navBarToggle">${document.body.classList.contains("dark") ? "‚òÄÔ∏è" : "üåô"}</button>
        </div>

        <div style="margin:20px 0 0 20px;">
            <a href="index.html?p=squadre"
                style="display:inline-block;padding:8px 16px;background:#2e6bf9;color:white;text-decoration:none;border-radius:8px;font-weight:bold;transition:0.2s;">
                ‚üµ Torna indietro
            </a>
        </div>

        <h2 style="text-align:center;">${squadra.nome}</h2>

        <div style="text-align:center;">
            <img src="./images/${squadra['nome'].toLowerCase().replaceAll(' ', '').replaceAll('#', '')}.jpg" alt="${squadra.nome} Logo"
            onerror="this.onerror=null; this.src='./images/logo-placeholder.png';" style="width:150px; height:150px;">
        </div>

        <h2 style="text-align:center; margin-top:20px;">Informazioni Squadra</h2>

        <div style="margin-top: 20px; text-align: center; font-size:16px;">
            <a style="font-weight: bold" href="?p=girone&id=${girone.id}">Girone ${girone.nome}</a>
        </div>

        <div class="columns">
            <div style="flex:1;">
                <h2 style="text-align:center;">Classifica Girone</h2>
                <table style="width:100%; border-collapse: collapse; text-align: center;">
                    <tr style="background:#2e6bf9; color:white;">
                        <th>Pos</th>
                        <th>Squadra</th>
                        <th>Punti</th>
                        <th>Differenza Reti</th>
                    </tr>

                    ${squadreGirone.map((s, i) => `
                        <tr class="table-row ${s.id === squadra.id ? 'current-team' : ''}">
                            <td>${i+1}</td>
                            <td>${s.id === squadra.id ? s.nome : `<a href="?p=squadra&id=${s.id}">${s.nome}</a>`}</td>
                            <td>${s.punti}</td>
                            <td>${s.differenza_reti}</td>
                        </tr>
                    `).join("")}
                </table>
            </div>

            <div style="flex:1;">
                <h2 style="text-align:center;">Partite</h2>
                <table style="width:100%; border-collapse: collapse; text-align:center;">
                    <tr style="background:#2e6bf9; color:white;">
                        <th>Squadra 1</th>
                        <th>Gol</th>
                        <th>-</th>
                        <th>Gol</th>
                        <th>Squadra 2</th>
                        <th>Data</th>
                    </tr>

                    ${partite.map(g => {
                        const played = g.gol1 !== null && g.gol2 !== null;

                        let resultClass = "";
                        if (played) {
                            const won =
                                (g.team1 === squadra.nome && g.gol1 > g.gol2) ||
                                (g.team2 === squadra.nome && g.gol2 > g.gol1);
                            const draw = g.gol1 === g.gol2;

                            if (won) resultClass = "match-win";
                            else if (draw) resultClass = "match-draw";
                            else resultClass = "match-loss";
                        }

                        return `
                            <tr class="match-row ${played ? resultClass : 'match-not-played'}">
                                <td>
                                    ${g.team1 === squadra.nome
                                    ? g.team1
                                    : `<a href="?p=squadra&id=${squadre.find(s => s.nome === g.team1)?.id}">${g.team1}</a>`
                                }
                                </td>
                                <td>${g.gol1 ?? ""}</td>
                                <td>-</td>
                                <td>${g.gol2 ?? ""}</td>
                                <td>
                                    ${g.team2 === squadra.nome
                                    ? g.team2
                                    : `<a href="?p=squadra&id=${squadre.find(s => s.nome === g.team2)?.id}">${g.team2}</a>`
                                }
                                </td>
                                <td>${formatDate(g.orario)}</td>
                            </tr>`;
                    }).join("")}
                </table>
            </div>
        </div>
    `;
    }

    async function renderGironi() {
        const [gironi, squadre] = await Promise.all([
            loadGironi(),
            loadSquadre()
        ]);

        const gironiData = gironi.map(g => {
            const teamsInGirone = squadre.filter(s => s.girone == g.id);

            teamsInGirone.sort((a, b) => {
                if (a.punti !== b.punti) return b.punti - a.punti;
                return b.differenza_reti - a.differenza_reti;
            });

            return {
                id: g.id,
                nome: g.nome,
                classifica: teamsInGirone,
                punti: g.punti
            };
        });

        document.querySelector(".content").innerHTML = `
        <h1>Oriani League</h1>

        <div class="navbar">
            <a href="?p=home">Home</a>
            <a href="?p=squadre">Squadre</a>
            <a href="?p=gironi" class="active">Gironi</a>
            <a href="?p=finali">Tabellone</a>
            <button id="themeToggle" onclick="toggleTheme()" class="navBarToggle">${document.body.classList.contains("dark") ? "‚òÄÔ∏è" : "üåô"}</button>
        </div>

        <h2 style="text-align:center;">Gironi</h2>

        <div class="teams-container" id="gironiContainer"></div>
    `;

        const container = document.getElementById("gironiContainer");

        gironiData.forEach(g => {
            const card = document.createElement("a");
            card.href = `?p=girone&id=${g.id}`;
            card.className = "team-card";
            card.style.height = "auto";
            card.style.padding = "15px";

            const top4 = g.classifica.slice(0, 4);

            card.innerHTML = `
            <div class="team-name" style="font-size:22px; margin-bottom:10px;">
                ${g.nome}
            </div>

            <table style="width:100%; font-size:14px; text-align:center; border-collapse: collapse;">
                <tr style="font-weight:bold;">
                    <td>#</td>
                    <td>Squadra</td>
                    <td>P</td>
                </tr>
                ${top4
                .map((t, i) => `
                        <tr>
                            <td>${i + 1}</td>
                            <td>${t.nome}</td>
                            <td>${t.punti}</td>
                        </tr>
                    `)
                .join("")}
            </table>
        `;

            container.appendChild(card);
        });
    }

    async function renderGirone() {
        const params = new URLSearchParams(window.location.search);
        const id = Number(params.get("id"));
        if (!id) return;

        const [
            gironi, squadre, games, marcatori, calciatori
        ] = await Promise.all([
            loadGironi(),
            loadSquadre(),
            loadGames(),
            loadMarcatori(),
            loadCalciatori()
        ]);

        const girone = gironi.find(g => g.id === id);
        if (!girone) {
            document.querySelector(".content").innerHTML = `<h2 style="text-align:center; color:red;">Girone non trovato.</h2>`;
            return;
        }

        const squadreGirone = squadre
            .filter(s => s.girone === id)
            .sort((a, b) => b.punti - a.punti || b.differenza_reti - a.differenza_reti);

        const partite = games.filter(g => {
            const t1 = squadre.find(s => s.id === g.id1)?.nome;
            const t2 = squadre.find(s => s.id === g.id2)?.nome;
            return squadreGirone.some(s => s.nome === t1 || s.nome === t2);
        }).map(g => ({
            ...g,
            team1: squadre.find(s => s.id === g.id1)?.nome ?? "???",
            team2: squadre.find(s => s.id === g.id2)?.nome ?? "???"
        })).sort((a, b) => new Date(a.orario) - new Date(b.orario));

        const marcatoriGirone = marcatori
            .map(m => {
                const c = calciatori.find(c => c.id === m.calciatore);
                const s = squadre.find(s => s.id === c.squadra);
                if (s.girone !== id) return null;
                return { giocatore: c.nome, squadra: s.nome, gol: m.gol };
            })
            .filter(x => x)
            .reduce((acc, curr) => {
                const existing = acc.find(a => a.giocatore === curr.giocatore);
                if (existing) existing.gol += curr.gol;
                else acc.push(curr);
                return acc;
            }, [])
            .sort((a, b) => b.gol - a.gol);

        const content = document.querySelector(".content");
        content.innerHTML = `
        <h1>Oriani League</h1>
        <div class="navbar">
            <a href="?p=home">Home</a>
            <a href="?p=squadre">Squadre</a>
            <a href="?p=gironi" class="active">Gironi</a>
            <a href="?p=finali">Tabellone</a>
            <button id="themeToggle" onclick="toggleTheme()" class="navBarToggle">${document.body.classList.contains("dark") ? "‚òÄÔ∏è" : "üåô"}</button>
        </div>
        <div style="margin:20px 0 0 20px;">
            <a href="?p=gironi" style="display:inline-block;padding:8px 16px;background:#2e6bf9;color:white;text-decoration:none;border-radius:8px;font-weight:bold;">
                ‚üµ Torna indietro
            </a>
        </div>
        <h2 style="text-align:center;">${girone.nome}</h2>
        <div class="columns" ">
            <div style="flex:1;">
                <h2 style="text-align:center;">Classifica</h2>
                <table style="width:100%; border-collapse: collapse;text-align:center;">
                    <tr style="background:#2e6bf9; color:white;">
                        <th>Pos</th>
                        <th>Squadra</th>
                        <th>Punti</th>
                        <th>Diff</th>
                    </tr>
                    ${squadreGirone.map((s, i) => `
                        <tr>
                            <td>${i+1}</td>
                            <td><a href="?p=squadra&id=${s.id}">${s.nome}</a></td>
                            <td>${s.punti}</td>
                            <td>${s.differenza_reti}</td>
                        </tr>`).join('')}
                </table>
            </div>
            <div style="flex:1;">
                <h2 style="text-align:center;">Partite</h2>
                <table style="width:100%; border-collapse: collapse;text-align:center;">
                    <tr style="background:#2e6bf9; color:white;">
                        <th>Squadra 1</th>
                        <th>Gol</th>
                        <th>-</th>
                        <th>Gol</th>
                        <th>Squadra 2</th>
                        <th>Data</th>
                    </tr>
                    ${partite.map(g => {
                        const t1 = squadre.find(s => s.nome === g.team1);
                        const t2 = squadre.find(s => s.nome === g.team2);

                        return `
                            <tr>
                                <td>${t1 ? `<a href="?p=squadra&id=${t1.id}">${g.team1}</a>` : g.team1}</td>
                                <td>${g.gol1 ?? ''}</td>
                                <td>-</td>
                                <td>${g.gol2 ?? ''}</td>
                                <td>${t2 ? `<a href="?p=squadra&id=${t2.id}">${g.team2}</a>` : g.team2}</td>
                                <td>${formatDate(g.orario)}</td>
                            </tr>`;
                    }).join('')}
                </table>
            </div>
        </div>
        <div style="max-width:800px; margin:40px auto;">
            <h2 style="text-align:center;">Classifica Marcatori</h2>
            <table style="width:100%; border-collapse: collapse; text-align:center;">
                <tr style="background:#2e6bf9; color:white;">
                    <th>Giocatore</th>
                    <th>Squadra</th>
                    <th>Gol</th>
                </tr>
                ${marcatoriGirone.map(m => {
                    const t1 = squadre.find(s => s.nome === m.squadra);
                    return`
                        <tr>
                            <td>${m.giocatore}</td>
                            <td>${t1 ? `<a href='?p=squadra&id=${t1.id}'>${m.squadra}</a>` : m.squadra}</td>
                            <td>${m.gol}</td>
                        </tr>`
                }).join('')}
            </table>
        </div>
    `;
    }

    const ELIMINATION_START = new Date("2025-06-15");

    const ROUNDS = [
        { name: "Ottavi", start: "2025-06-15", end: "2025-06-17" },
        { name: "Quarti", start: "2025-06-18", end: "2025-06-20" },
        { name: "Semifinali", start: "2025-06-21", end: "2025-06-23" },
        { name: "Finale", start: "2025-06-24", end: "2025-06-25" }
    ];

    function getRound(matchDate) {
        const d = new Date(matchDate);

        return ROUNDS.find(r =>
            d >= new Date(r.start) && d <= new Date(r.end)
        )?.name || null;
    }

    function buildBracket(games) {
        const bracket = {};

        ROUNDS.forEach(r => bracket[r.name] = []);

        games
            .filter(g => new Date(g.orario) >= ELIMINATION_START)
            .forEach(g => {
                const round = getRound(g.orario);
                if (round) bracket[round].push(g);
            });

        return bracket;
    }

    async function renderFinali() {
        const [squadre, games] = await Promise.all([
            loadSquadre(),
            loadGames()
        ]);

        const bracketData = buildBracket(games);

        const structure = [
            { name: "Ottavi", count: 8 },
            { name: "Quarti", count: 4 },
            { name: "Semifinali", count: 2 },
            { name: "Finale", count: 1 }
        ];

        document.querySelector(".content").innerHTML = `
        <h1>Oriani League</h1>
        <div class="navbar">
            <a href="?p=home">Home</a>
            <a href="?p=squadre">Squadre</a>
            <a href="?p=gironi">Gironi</a>
            <a href="?p=finali" class="active">Tabellone</a>
            <button id="themeToggle" onclick="toggleTheme()" class="navBarToggle">${document.body.classList.contains("dark") ? "‚òÄÔ∏è" : "üåô"}</button>
        </div>

        <h2 style="text-align:center; margin-top: 20px;">Tabellone Finale</h2>

        <div class="bracket-wrapper" style="min-height: 800px;">
            ${structure.map(round => {
            const realMatches = bracketData[round.name] || [];
            const slots = new Array(round.count).fill(null).map((_, i) => realMatches[i] || null);

            return `
                <div class="bracket-column">
                    <div class="bracket-header">${round.name}</div>

                    ${slots.map(m => {
                        let cardContent = "";

                        if (!m) {
                            cardContent = `
                                    <div class="match-card" style="opacity: 0.6;">
                                        <div class="team-row">
                                            <span style="color:var(--text-secondary); font-style:italic;">TBD</span>
                                            <strong style="background: #999;">-</strong>
                                        </div>
                                        <div class="team-row">
                                            <span style="color:var(--text-secondary); font-style:italic;">TBD</span>
                                            <strong style="background: #999;">-</strong>
                                        </div>
                                        <div class="match-date">In attesa</div>
                                    </div>`;
                        }
                        else {
                            const t1 = squadre.find(s => s.id === m.id1)?.nome ?? "TBD";
                            const t2 = squadre.find(s => s.id === m.id2)?.nome ?? "TBD";
                            const score1 = m.gol1 !== null ? m.gol1 : "";
                            const score2 = m.gol2 !== null ? m.gol2 : "";

                            const w1 = (m.gol1 !== null && m.gol2 !== null && m.gol1 > m.gol2) ? 'font-weight:bold; color:var(--text-main);' : 'color:var(--text-secondary);';
                            const w2 = (m.gol1 !== null && m.gol2 !== null && m.gol2 > m.gol1) ? 'font-weight:bold; color:var(--text-main);' : 'color:var(--text-secondary);';

                            cardContent = `
                                    <div class="match-card">
                                        <div class="team-row" style="${w1}">
                                            <span>${t1}</span>
                                            <strong>${score1}</strong>
                                        </div>
                                        <div class="team-row" style="${w2}">
                                            <span>${t2}</span>
                                            <strong>${score2}</strong>
                                        </div>
                                        <div class="match-date">
                                            ${formatDate(m.orario).split(' ')[0]}
                                        </div>
                                    </div>`;
                        }

                        return `
                                <div class="match-wrapper">
                                    ${cardContent}
                                </div>
                                `;
                    }).join("")}
                </div>
                `;
            }).join("")}
        </div>
        `;
    }

    let showAllGames = false;
    let allGamesCache = [];
    let allSquadreCache = [];

    function renderGames(games, squadre) {
        allGamesCache = games;
        allSquadreCache = squadre;

        const table = document.getElementById("gamesTable");

        const now = new Date();
        const oneWeekAgo = new Date(now.getTime() - 2 * 24 * 60 * 60 * 1000);
        const nextWeek = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);

        let list = showAllGames
            ? games
            : games.filter(g => new Date(g.orario) >= oneWeekAgo && new Date(g.orario) <= nextWeek);

        list.sort((a, b) => new Date(a.orario) - new Date(b.orario));

        list.forEach(g => {
            console.log(g.id1)
            const team1 = squadre.find(s => s.id === g.id1)?.nome ?? "???";
            const team2 = squadre.find(s => s.id === g.id2)?.nome ?? "???";

            const played = g.gol1 !== null && g.gol2 !== null;
            const className = played ? "played" : "not-played";

            const tr = document.createElement("tr");
            tr.className = className;

            tr.innerHTML = `
            <td>${team1 ? `<a href='?p=squadra&id=${g.id1}' style="font-weight: normal">${team1}</a>` : team1}</td>
            <td>${g.gol1 ?? ""}</td>
            <td>-</td>
            <td>${g.gol2 ?? ""}</td>
            <td>${team2 ? `<a href='?p=squadra&id=${g.id2}' style="font-weight: normal">${team2}</a>` : team2}</td>
            <td>${formatDate(g.orario)}</td>
        `;

            table.appendChild(tr);
        });
    }

    function renderScorers(marcatori, calciatori, squadre, gironi) {
        const table = document.getElementById("scorersTable");

        const map = {};

        marcatori.forEach(m => {
            if (!map[m.calciatore]) map[m.calciatore] = 0;
            map[m.calciatore] += m.gol;
        });

        const rows = Object.entries(map)
            .map(([id, gol]) => {
                const c = calciatori.find(x => x.id === Number(id));
                const s = squadre.find(x => x.id === c.squadra);
                const g = gironi.find(x => x.id === s.girone);

                return {
                    giocatore: c.nome,
                    squadra: s.nome,
                    girone: g.nome,
                    gol
                };
            })
            .sort((a, b) => b.gol - a.gol);

        rows.forEach(r => {
            const tr = document.createElement("tr");

            const t = squadre.find(s => s.nome === r.squadra);
            const g = gironi.find(g => g.nome === r.girone);
            tr.innerHTML = `
            <td>${r.giocatore}</td>
            <td>${t ? `<a href='?p=squadra&id=${t.id}' style="font-weight: normal">${r.squadra}</a>` : r.squadra}</td>
            <td>${g ? `<a href='?p=squadra&id=${g.id}' style="font-weight: normal">${r.girone}</a>` : r.girone}</td>
            <td>${r.gol}</td>
        `;
            table.appendChild(tr);
        });

        showTop20()
    }

    function HideShow() {
        showAllGames = !showAllGames;

        document.getElementById("hideShow").innerHTML =
            showAllGames ? "Mostra ultime partite" : "Mostra tutte le partite";

        renderGames(allGamesCache, allSquadreCache);
    }

    let showingTop20 = false;
    function showTop20() {
        const table = document.getElementById('scorersTable');
        const rows = Array.from(table.querySelectorAll('tr')).slice(1);

        if (!showingTop20) {
            rows.forEach((r, i) => r.style.display = i < 20 ? '' : 'none');
            document.getElementById('top20Btn').innerText = 'Mostra tutti';
        } else {
            rows.forEach(r => r.style.display = '');
            document.getElementById('top20Btn').innerText = 'Mostra Top 20';
        }

        showingTop20 = !showingTop20;
    }

    function toggleTheme() {
        const isDark = document.body.classList.toggle("dark");
        localStorage.setItem("theme", isDark ? "dark" : "light");

        const btn = document.getElementById("themeToggle");
        btn.textContent = document.body.classList.contains("dark") ? "‚òÄÔ∏è" : "üåô";
    }

    const savedTheme = localStorage.getItem("theme");
    if (savedTheme === "dark") {
        document.body.classList.add("dark");
    }

    loadPage();
</script>

<footer>
    <div style="max-width: 1200px; margin: 0 auto;">
        <p>Oriani League ¬© 2025 | Fatto da Savogpt</p>
        <p>Email: nun me scassa u cazz | Tel: 104 676 7104</p>
        <p>
            <a href="#" style="color:white; text-decoration:underline; margin:0 5px;">Privacy</a> |
            <a href="#" style="color:white; text-decoration:underline; margin:0 5px;">Termini</a>
        </p>
    </div>
</footer>
</body>
</html>
